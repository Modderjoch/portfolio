---
import { getCollection } from "astro:content";
import ProjectCard from "./ProjectCard.astro";
import ProjectPreview from "./ProjectPreview.astro";

const projects = await getCollection("projects");
projects.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<section class="mb-20">
    <div
        class="grid gap-6 grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
    >
        {projects.map((project) => <ProjectCard project={project} />)}
    </div>
</section>

{projects.map((project) => <ProjectPreview project={project} />)}

<script>
    document.querySelectorAll(".project-card").forEach((card) => {
        card.addEventListener("click", () => {
            const modal = document.getElementById(card.dataset.modal);
            modal.classList.remove("hidden");
            modal.classList.add("flex");
            document.body.style.overflow = "hidden";
        });
    });

    document.querySelectorAll(".modal-close, .modal-backdrop").forEach((el) => {
        el.addEventListener("click", () => {
            const modal = el.closest("[id^='modal-']");
            modal.classList.add("hidden");
            modal.classList.remove("flex");
            document.body.style.overflow = "";
        });
    });
</script>
